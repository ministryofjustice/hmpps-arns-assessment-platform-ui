# Development mode
#
# - target: development (supports hot-reload)
# - command: npm run start:dev
# - entrypoint: ui-entrypoint.sh (auto-installs dependencies if needed on startup)
# - ports: 3000 (app), 9229 (debugger) exposed to host
# - volumes: source mounted for live code changes
# - depends_on: api, redis, localstack (full backend stack)
#
# Dependency tree:
# ui
# ├── api
# │   ├── postgres
# │   ├── auth
# │   └── localstack
# ├── redis
# └── localstack

services:
  ui:
    build:
      target: development
    entrypoint: ["/scripts/ui-entrypoint.sh"]
    command: npm run start:dev
    ports:
      - "3000:3000"
      - "9229:9229"
    depends_on:
      - api
      - redis
      - localstack
      - wiremock
    environment:
      ENVIRONMENT_NAME: dev
      REDIS_ENABLED: true
      AUTH_CODE_CLIENT_ID: hmpps-arns-assessment-platform-ui
      AUTH_CODE_CLIENT_SECRET: clientsecret
      CLIENT_CREDS_CLIENT_ID: hmpps-arns-assessment-platform-ui-system
      CLIENT_CREDS_CLIENT_SECRET: clientsecret
      HMPPS_AUTH_URL: http://auth:8080/auth
      HMPPS_AUTH_EXTERNAL_URL: http://localhost:9090/auth
      TOKEN_VERIFICATION_ENABLED: false
      TOKEN_VERIFICATION_API_URL: http://localhost:9090/verification
      EXAMPLE_API_URL: http://wiremock:8080/example-api
      AAP_API_URL: http://api:8080
    volumes:
      - ..:/app:cached
      - node_modules:/app/node_modules
      - ./scripts/ui-entrypoint.sh:/scripts/ui-entrypoint.sh:ro

  wiremock:
    image: wiremock/wiremock
    restart: always
    ports:
      - "9091:8080"
    networks:
      - hmpps
