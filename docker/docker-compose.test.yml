# docker-compose.test.yml is used to spin up the app specifically for integration testing.
# It stacks on top of `docker-compose.local.yml`, allowing tests to run
# against local deployment.

services:
  wiremock:
    image: wiremock/wiremock
    networks:
      - hmpps
    container_name: wiremock
    restart: always
    ports:
      - "9091:8080"

  ui:
    build:
      target: production
    depends_on:
      - wiremock
    command: npm run start
    ports:
      - "3007:3000"
    environment:
      AUTH_CODE_CLIENT_ID: clientid
      AUTH_CODE_CLIENT_SECRET: clientsecret
      CLIENT_CREDS_CLIENT_ID: clientid
      CLIENT_CREDS_CLIENT_SECRET: clientsecret
      HMPPS_AUTH_URL: http://wiremock:8080/auth
      HMPPS_AUTH_EXTERNAL_URL: http://localhost:9091/auth
      TOKEN_VERIFICATION_API_URL: http://wiremock:8080/verification
      TOKEN_VERIFICATION_ENABLED: true
      EXAMPLE_API_URL: http://wiremock:8080/example-api
      ENVIRONMENT_NAME: dev
